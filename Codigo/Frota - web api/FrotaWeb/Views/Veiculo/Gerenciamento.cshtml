@model FrotaWeb.Models.VeiculoViewModel

@{
    var percurso = ViewBag.Percurso as FrotaWeb.Models.PercursoViewModel;
}

<main class="main-content">
    @if (percurso != null)
    {
        <div class="management-layout">
            <div class="management-cards">
                @await Html.PartialAsync("_PercursoCard", percurso)
                @await Html.PartialAsync("_VeiculoCard", Model)
            </div>
            <div class="route-map-container-wrapper">
                @{
                    ViewBag.OriginLat = percurso.LatitudePartida;
                    ViewBag.OriginLng = percurso.LongitudePartida;
                    ViewBag.DestLat = percurso.LatitudeChegada;
                    ViewBag.DestLng = percurso.LongitudeChegada;
                    ViewBag.IdPercurso = percurso.Id;
                    ViewBag.MapId = "routeMap";
                }
                @await Html.PartialAsync("_RouteMap")
            </div>
        </div>
    }
    else
    {
        <div class="management-cards">
            @await Html.PartialAsync("_VeiculoCard", Model)
        </div>
    }

    <div class="actions-grid" style="margin-top: var(--space-6);">
        @if (percurso == null)
        {
            <a href="@Url.Action("RegistrarSaida", "Veiculo", new { idVeiculo = Model.Id })" class="btn btn-primary">
                <i class="fas fa-sign-out-alt"></i> Registrar Saída
            </a>
        }
        else
        {
            <a href="@Url.Action("RegistrarVistoria", "Veiculo", new { idPercurso = ViewBag.IdPercursoAtual, idVeiculo = Model.Id })" class="btn btn-warning">
                <span class="badge badge-warning" style="margin-right: var(--space-2);">●</span>
                <i class="fas fa-clipboard-check"></i> Realizar Vistoria
            </a>
            <a href="@Url.Action("RegistrarAbastecimento", "Veiculo", new { idPercurso = ViewBag.IdPercursoAtual, idVeiculo = Model.Id })" class="btn btn-primary">
                <i class="fas fa-gas-pump"></i> Abastecer
            </a>
            <a href="@Url.Action("SolicitarManutencao", "Veiculo", new { idPercurso = ViewBag.IdPercursoAtual, idVeiculo = Model.Id })" class="btn btn-info">
                <i class="fas fa-tools"></i> Solicitar Manutenção
            </a>
            <a href="@Url.Action("FinalizarUso", "Veiculo", new { idPercurso = ViewBag.IdPercursoAtual, idVeiculo = Model.Id })" class="btn btn-danger">
                <i class="fas fa-times-circle"></i> Finalizar Uso
            </a>
        }
    </div>
</main>

<style>
    .actions-grid {
    display: flex;
        flex-wrap: wrap;
        gap: var(--space-4);
        margin-top: var(--space-6);
}

    .actions-grid .btn {
        flex: 1;
        min-width: 200px;
}
</style>
